> toString(36)

### 1.位运算表示

> Decimal 十进制

#### 1.二进制 Binary

二进制数在JavaScript中以`0b`或`0B`开头。

```javascript
const TransitionHydrationLane: Lane = /*                */ 0b0000000000000000000000001000000;
```

```javascript
//数字转二进制
//正数情况
let num = 10;
let binaryString = num.toString(2); // '1010'

// 负数情况
let num = 10
let binaryString = num.toString(2); // -1010

// 二进制补码形式来表示数字

```

```javascript
// 二进制转数字
let binaryString = '1010';
let num = parseInt(binaryString, 2); // 10
console.log(num); // 输出：10
```

#### 2.八进制 Octal

在JavaScript中，八进制数以`0o`或`0O`开头。例如：

```javascript
let octalNumber = 0o12; // 十进制中的10
console.log(octalNumber); // 输出：10
```

```javascript
// 数字转二进制
let num = 10;
let octalString = num.toString(8); // '12'
console.log(octalString); // 输出：'12'
```

```javascript
//字符串转八进制
let octalString = '12';
let num = parseInt(octalString, 8); // 10
console.log(num); // 输出：10
```

注意，`parseInt`函数会忽略字符串中的非数字字符。如果字符串以`0o`开头，`parseInt`函数会忽略这两个字符。

#### 3.十六进制 Hexadecimal

在JavaScript中，十六进制数以`0x`或`0X`开头。例如：

```javascript
let hexNumber = 0xA; // 十进制中的10
console.log(hexNumber); // 输出：10
```

```javascript
let num = 10;
let hexString = num.toString(16); // 'a'
console.log(hexString); // 输出：'a'
```

```javascript
let hexString = 'a';
let num = parseInt(hexString, 16); // 10
console.log(num); // 输出：10
```

1. 位运算只能在整型变量之间进行运算
2. js 中的`Number`类型在底层都是以浮点数(**[参考 IEEE754 标准](https://www.h-schmidt.net/FloatConverter/IEEE754.html)**)进行存储.
3. js 中所有的按位操作符的操作数都会被[转成补码（two's complement）](https://www.ecma-international.org/ecma-262/5.1/#sec-9.5)形式的`有符号32位整数`.

> 所以在 js 中使用位运算时, 有 2 种情况会造成结果异常:
>
> 1. 操作数为浮点型(虽然底层都是浮点型, 此处理解为显示性的浮点型)
>
>    - 转换流程: 浮点数 -> 整数(丢弃小数位) -> 位运算
>
> 2. 操作数的大小超过`Int32`范围(`-2^31 ~ 2^31-1`). 超过范围的二进制位会被截断, 取`低位32bit`.
>
>    ```undefined
>    Before: 11100110111110100000000000000110000000000001
>                         
>          After:              10100000000000000110000000000001
>    ```
>    
>    在对 ECMAScript 中的数值应用位操作符时，后台会发生转换：64 位数值会转换为 32 位数值，然
>    
>    后执行位操作，最后再把结果从 32 位转换为 64 位存储起来。

### 2.位运算符

![image-20231116201702202](../../image/image-20231116201702202.png)



### 3.常见位操作

#### 1.判断奇偶

```javascript
(x & 1) == 1  等价于 x % 2 == 1
(x & 1) == 0  等价于 x % 2 == 0
```

`1` 的二进制位(四个比特位的话)` 0001` , `0` 为 `0000`

#### 2.位操作实现乘除法

```javascript
int a = 2;
a >> 1; ---> 1
a << 1; ---> 4
// 注意边界 10000000000 << 1  为-1474836480
```

#### 3.交换两数

`a ^ b ^ b = a` 

```JavaScript
let a = 8
let b = 4

function swap(a,b){
    a ^= b
    b ^= a
    a ^= b
    console.log(a,b)
}
swap(a,b)
```

#### 4.位操作交换符号

```javascript
let a = 10
~a + 1  // -10 

```

#### 5.位操作求绝对值

整数的绝对值是其本身，负数的绝对值正好可以对其进行取反加一求得，即我们首先判断其符号位（整数右移 31 位得到 0，负数右移 31 位得到 -1,即 0xffffffff），然后根据符号进行相应的操作

```javascript
function abs(int a) {
  let i = a >> 31;
  return i == 0 ? a : (~a + 1);
}
```

上面的操作可以进行优化，可以将 i == 0 的条件判断语句去掉。我们都知道符号位 i 只有两种情况，即 i = 0 为正，i = -1 为负。对于任何数与 0 异或都会保持不变，与 -1 即 0xffffffff 进行异或就相当于对此数进行取反,因此可以将上面三目元算符转换为((a^i)-i)，即整数时 a 与 0 异或得到本身，再减去 0，负数时与 0xffffffff 异或将 a 进行取反，然后在加上 1，即减去 i(i =-1)

```javascript
function abs2(int a) {
  let i = a >> 31;
  return ((a^i) - i);
}
```

>  补码情况下：任何数与`0`异或，保持不变。与`-1`异或 等于 取非`^`
>
>  `0 `   32位补码 `00000000000000000000000000000000`
>
>  `-1` 32位补码 ` 11111111111111111111111111111111`
>
>  `-5` 32位补码 ` 11111111111111111111111111111011`

#### 6.位操作进行高低位交换

给定一个 16 位的无符号整数，将其高 8 位与低 8 位进行交换，求出交换后的值，如：

从上面移位操作我们可以知道，只要将无符号数 a>>8 即可得到其高 8 位移到低 8 位，高位补 0；将 a<<8 即可将 低 8 位移到高 8 位，低 8 位补 0，然后将 a>>8 和 a<<8 进行或操作既可求得交换后的结果。
```c
unsigned short a = 34520;
a = (a >> 8) | (a << 8);
```

#### 7.位操作进行二进制逆序

将无符号数的二进制表示进行逆序，求取逆序后的结果，如

```
数34520的二进制表示：
10000110 11011000

逆序后则为：
00011011 01100001
它的十进制为7009
```

在字符串逆序过程中，可以从字符串的首尾开始，依次交换两端的数据。在二进制中使用位的高低位交换会更方便进行处理，这里我们分组进行多步处理。

- 第一步:以每 2 位为一组，组内进行高低位交换

  ```text
  交换前： 10 00 01 10 11 01 10 00
  交换后： 01 00 10 01 11 10 01 00
  ```

- 第二步：在上面的基础上，以每 4 位为 1 组，组内高低位进行交换

  ```
  交换前： 0100 1001 1110 0100
  交换后： 0001 0110 1011 0001
  ```

- 第三步：以每 8 位为一组，组内高低位进行交换

  ```
  交换前： 00010110 10110001
  交换后： 01100001 00011011
  ```

- 第四步：以每16位为一组，组内高低位进行交换

  ```
  交换前： 0110000100011011
  交换后： 0001101101100001
  ```

对于上面的第一步，依次以 2 位作为一组，再进行组内高低位交换，这样处理起来比较繁琐，下面介绍另外一种方法进行处理。先分别取原数 10000110 11011000 的奇数位和偶数位，将空余位用 0 填充：

```
原数：  10000110 11011000
奇数位： 10000010 10001000
偶数位： 00000100 01010000
```

再将奇数位右移一位，偶数位左移一位，此时将两个数据相或即可以达到[奇偶位](https://www.zhihu.com/search?q=奇偶位&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra={"sourceType"%3A"answer"%2C"sourceId"%3A736472332})上数据交换的效果：

```
原数：  10000110 11011000
奇数位右移一位： 0 10000010 1000100
偶数位左移一位：0000100 01010000 0
两数相或得到： 01001001 11100100
```

上面的方法用位操作可以表示为：

取a的奇数位并用 0 进行填充可以表示为：a & 0xAAAA

取a的偶数为并用 0 进行填充可以表示为：a & 0x5555 因此，上面的第一步可以表示为：
a = ((a & 0xAAAA) >> 1) | ((a & 0x5555) << 1)
同理，可以得到其第二、三和四步为：
a = ((a & 0xCCCC) >> 2) | ((a & 0x3333) << 2)
a = ((a & 0xF0F0) >> 4) | ((a & 0x0F0F) << 4)
a = ((a & 0xFF00) >> 8) | ((a & 0x00FF) << 8)
因此整个操作为：

```
unsigned short a = 34520;

a = ((a & 0xAAAA) >> 1) | ((a & 0x5555) << 1);
a = ((a & 0xCCCC) >> 2) | ((a & 0x3333) << 2);
a = ((a & 0xF0F0) >> 4) | ((a & 0x0F0F) << 4);
a = ((a & 0xFF00) >> 8) | ((a & 0x00FF) << 8);

```

#### 8.位操作统计二进制中1的个数

统计二进制1的个数可以分别获取每个[二进制位数](https://www.zhihu.com/search?q=二进制位数&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra={"sourceType"%3A"answer"%2C"sourceId"%3A736472332})，然后再统计其1的个数，此方法效率比较低。这里介绍另外一种高效的方法，同样以 34520 为例，我们计算其 a &= (a-1)的结果：

- 第一次：计算前：1000 0110 1101 1000 计算后：1000 0110 1101 0000
- 第二次：计算前：1000 0110 1101 0000 计算后：1000 0110 1100 0000
- 第二次：计算前：1000 0110 1100 0000 计算后：1000 0110 1000 0000 我们发现，没计算一次二进制中就少了一个 1，则我们可以通过下面方法去统计：

```javascript
count = 0  
while(a){  
  a = a & (a - 1);  
  count++;  
} 
```

#### 9.得到X 的最低位的1

```javascript
x & -x //得到最低位的1
```

x 与本身的关系 `0110` `1010` 前三位 相加得到第四位，所以 除了最后一位都第一位 中间的数 都是不相同的

#### 10.与本身取非的与位0

```javascript
x & ~x // 0
```

#### 11.检查两个整形变量是否有相反的符号

```javascript
let x,y
f = (x ^ y) < 0
```

[1]: http://graphics.stanford.edu/~seander/bithacks.html#OperationCounting
[2]: https://www.zhihu.com/question/38206659
[3]: https://www.jjj.de/fxt/fxtbook.pdf



















